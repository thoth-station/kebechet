Kebechet
========

> I'm Kebechet, goddess of freshness. I will keep your sources and dependencies fresh and up-to-date.

Kebechet is a SourceOps bot that automates updating dependencies of your project. Currently, it supports managing and updating Python projects based on [pipenv](https://docs.pipenv.org/) files (`Pipfile` and `Pipfile.lock`) or `requirements.txt`/`requirements.in` files (see [pip-tools](https://pypi.org/project/pip-tools/) - Kebechet is a replacement for it)

Configuration of Kebechet
-------------------------

Kebechet is configured using a simple YAML configuration file. Check documentation of managers to get all the available options.

Each configuration entry configures a manager. Please check [managers and examples](https://github.com/thoth-station/kebechet/tree/master/kebechet/managers) to get info about configuration options.

The YAML configuration file can be supplied directly as a path to a file on filesystem as well as a URL to a file - handy for managing configuration of your Kebechet deployment in a Git repository (you have to supply a URL to a raw YAML configuration file).

Managers
--------

Kebechet consists of managers that perform certain actions.

A list of managers with their configuration (documentation lives in the manger directory) can be found [in the repo](https://github.com/thoth-station/kebechet/tree/master/kebechet/managers).

Issues created by Kebechet
--------------------------

If there are any issues that have serious impact on Kebechet functionality, Kebechet will automatically open an issue in the given repository. These issues can be configuration issues of Kebechet itself or issues in manager itself.

Suppressing bot verbosity
-------------------------

Bot updates pull requests and issues and notifies about updates via comments (to issues or pull requests). You can suppress this behaviour by setting lable 'silent-bot' to issue or to a pull request. The bot will still perform updates but update comments will not be added.

This is especially helpful for example if you have failing updates of your dependency and you would like to keep the pull request opened and check for fix later. Setting 'silent-bot' label to the PR will suppress Kebechet to post updates and you will not retrieve spam messages anymore.

Notes
-----

To issue an update to Git repository, Kebechet creates branches in the provided repository.

Deploying Kebechet
------------------

To deploy Kebechet on an OpenShift cluster use kustomize and the [Thoth Application template files](https://github.com/thoth-station/thoth-application/tree/master/kebechet). Please ensure all the input parameters are correctly set for each of the templates.

If Kebechet finds the env variables `GITHUB_APP_ID` and `GITHUB_PRIVATE_KEY_PATH` it is going to authenticate as a Github Application.

Otherwise it is going to fallback to look for an OAuth token to authenticate for a successful run.

In both cases the SSH key is needed to commit code changes.

Running Kebechet Locally for Development
----------------------------------------

This guide is specific to GitHub. To run locally you need to [create a personal access token](https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token) on GitHub and add it to your envvars (`$ export GITHUB_KEBECHET_TOKEN=<your-token>`). Then all you need to do is run the Kebechet-CLI in the virtual environment generated by pipenv by running either:

1.  `pipenv run PYTHON_PATH=. kebechet-cli run-url -u <url-to-github-repo> -s <service-type>`
2.  `PYTHON_PATH=. kebechet-cli run-url -u <url-to-github-repo> -s <service-type>`

where `\<service-type\>` is `GITHUB`.

This assumes that you have a repository with proper configuration files that is ready for Kebechet to manage. For a very minimal repo see [here](<https://github.com/KPostOffice/khebhut_test>).

This guide can also be used to interact with GitLab and Pagure, the only difference being that the token must be generated for the specifice service, `\<service-type\>` should be GITLAB or PAGURE and the token env var should be `\<service-type\>\_KEBECHET\_TOKEN`.
